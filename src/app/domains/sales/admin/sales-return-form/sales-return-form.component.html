<div class="form-container">
    <nz-page-header nzTitle="Add Sales Return"
        [nzSubtitle]="'Customer: '+ customerNameSignal() +'/'+ customerNumberSignal()">
        <nz-breadcrumb [nzAutoGenerate]="true" nz-page-header-breadcrumb></nz-breadcrumb>
    </nz-page-header>

    <!-- BEGIN :: FORM SECTION -->
    <form nz-form nzLayout="vertical" [formGroup]="form" class="ant-advanced-search-form">
        <div formGroupName="salesReturnMaster" nz-row nzGutter="24">
            <!-- <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="5">
                <nz-form-item>
                    <nz-form-label>Bill No.</nz-form-label>
                    <nz-form-control>
                        <input nz-input placeholder="Bill no." formControlName="billNo" />
                    </nz-form-control>
                </nz-form-item>
            </div> -->

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Save Date</nz-form-label>
                    <nz-form-control>
                        <input nz-input placeholder="Date" formControlName="saveDate" />
                    </nz-form-control>
                </nz-form-item>
            </div>

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Pay Type</nz-form-label>
                    <nz-form-control>
                        <nz-select nz-input placeholder="Select pay type" formControlName="payTypeId">
                            <nz-option *ngFor="let item of payTypeSignal()" [nzValue]="item.id"
                                [nzLabel]="item.name"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>

            <!-- <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Customer</nz-form-label>
                    <nz-form-control>
                        <nz-select nz-input placeholder="Select condition" formControlName="condition">
                            <nz-option *ngFor="let item of conditionListSignal()" [nzValue]="item"
                                [nzLabel]="item"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div> -->

            <!-- <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Total Amount</nz-form-label>
                    <nz-form-control>
                        <input class="totalAmount" disabled nz-input placeholder="Total Amount"
                            [value]="totalAmountSignal()" />
                    </nz-form-control>
                </nz-form-item>
            </div> -->

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="8">
                <nz-form-item>
                    <nz-form-label>Remarks</nz-form-label>
                    <nz-form-control>
                        <textarea nzAutosize rows="4" nz-input placeholder="Remarks"
                            formControlName="remarks"></textarea>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <nz-divider></nz-divider>

        <div formArrayName="selectedStockList">
            <div *ngFor="let skill of inventoryList.controls let i=index">
                <div [formGroupName]="i">
                    <div nz-row [nzGutter]="16">
                        <div nz-col nzXs="24" nzMd="8" nzLg="6">
                            <nz-form-item>
                                <nz-form-label>Item</nz-form-label>
                                <nz-select [nzDisabled]="true" nz-input nzShowSearch placeholder="Select product"
                                    formControlName="medicine">
                                    @for (item of inventoryListSignal(); track item.stockMasterId) {
                                    <nz-option [nzValue]="item" [nzLabel]="item.name"></nz-option>
                                    }
                                </nz-select>
                            </nz-form-item>
                        </div>

                        <div nz-col nzXs="12" nzMd="4" nzLg="2">
                            <nz-form-item>
                                <nz-form-label>Qty.</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="0" placeholder="Quantity" formControlName="qty"
                                        (input)="onValueChange(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col nzXs="12" nzMd="4" nzLg="2">
                            <nz-form-item>
                                <nz-form-label>Rate</nz-form-label>
                                <nz-form-control>
                                    <input readonly nz-input type="number" min="1" formControlName="pricePerUnit"
                                        (input)="onValueChange(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col nzXs="12" nzMd="4" nzLg="2">
                            <nz-form-item>
                                <nz-form-label>Total</nz-form-label>
                                <nz-form-control>
                                    <input nz-input type="number" min="1" formControlName="totalAmt" readonly />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col nzXs="12" nzMd="4" nzLg="2">
                            <nz-form-item>
                                <nz-form-label>Dis. %</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="0" placeholder="Discount %"
                                        formControlName="disPercent" (focus)="setLastEdited('disPercent')"
                                        (blur)="onValueChange(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col nzXs="12" nzMd="4" nzLg="2">
                            <nz-form-item>
                                <nz-form-label>Dis. Amt.</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="0" placeholder="Discount Amount"
                                        formControlName="discountAmt" (focus)="setLastEdited('discountAmt')"
                                        (blur)="onValueChange(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <!-- TAXABLE -->
                        <div nz-col nzXs="12" nzMd="4" nzLg="2">
                            <nz-form-item>
                                <nz-form-label>Taxable</nz-form-label>
                                <nz-form-control>
                                    <input nz-input min="0" readonly formControlName="taxableAmt" readonly />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <!-- TAX -->
                        <div nz-col nzXs="12" nzMd="4" nzLg="2">
                            <nz-form-item>
                                <nz-form-label>Tax Amt.</nz-form-label>
                                <nz-form-control>
                                    <input readonly nz-input formControlName="taxAmt" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="24" [nzMd]="6" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Net Amt.</nz-form-label>
                                <nz-form-control>
                                    <input nz-input placeholder="Transaction Amount" formControlName="transAmount"
                                        readonly (keydown.enter)="onEnterKeyPress(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- END :: FORM SECTION -->

    <!-- BEGIN :: TABLE SECTION -->
    <nz-table #basicTable [nzBordered]="true" [nzData]="selectedItemsListSignal()" [nzSize]="'middle'"
        [nzShowPagination]="'false'">
        <thead>
            <tr>
                <th nzWidth="3%">Sn.</th>
                <th nzWidth="20%">Item</th>
                <th nzWidth="5%">Qty</th>
                <th nzWidth="5%">Rate</th>
                <th nzWidth="5%">Total</th>
                <th nzWidth="5%">Dis. Amt</th>
                <th nzWidth="5%">Taxable Amt</th>

                <th nzWidth="5%">Tax Amt</th>
                <th nzWidth="10%">Net Amt</th>
                <th nzWidth="10%">Table Actions</th>
            </tr>
        </thead>
        <tbody>
            @for (row of selectedItemsListSignal(); track $index ; ) {
            <tr>
                <td>{{ $index+1 }}.</td>
                <td>{{ row.name }}</td>
                <td>{{ row.qty }}</td>
                <td>{{ row.pricePerUnit }}</td>
                <td>{{ row.totalAmt |number :'1.1-2'}}</td>
                <td>{{ row.discountAmt|number :'1.2-2' }}</td>
                <td>{{ row.taxableAmt|number :'1.2-2' }}</td>

                <td>{{ row.taxAmt|number :'1.2-2' }}</td>
                <td>{{ row.netAmt|number :'1.2-2' }}</td>
                <td>
                    <lib-table-action-buttons (edit)="onEdit(row)" (delete)="onDelete(row.detailId)" />
                </td>
            </tr>
            }
        </tbody>
        <tfoot nzSummary>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>Net Total</td>
                <td>
                    <span nz-typography nzType="danger">{{ totalAmountSignal() | number:'1.2-2' }}</span>
                </td>
            </tr>
        </tfoot>
    </nz-table>
    <nz-divider></nz-divider>

    <div nz-row nzType="flex" nzJustify="end" nzAlign="middle">
        <nz-space nzSize="middle">
            <button *nzSpaceItem nz-button nzType="default" (click)="onCancel()">Cancel</button>
            <button *nzSpaceItem nz-button nzType="primary" (click)="onSave()">
                <span nz-icon nzType="save" nzTheme="outline"></span> Save
            </button>
        </nz-space>
    </div>
    <!-- END :: TABLE SECTION -->
</div>